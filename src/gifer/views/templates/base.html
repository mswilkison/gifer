<!DOCTYPE HTML>
<html>
  <head>
    <title>Welcome to gifer</title>
<!--    <script>
    function initStream() {
       var mediaConstraints = {
            video: true
        };

        var videosContainer = document.getElementById('videos-container');

        var successCallback = function(stream) {
            var inVideo = document.createElement('video');
            inVideo.src = window.URL.createObjectURL(stream);
            inVideo.play();
            videosContainer.appendChild(inVideo);

            var mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.mimeType = 'image/gif';

            mediaRecorder.videoWidth = 320;
            mediaRecorder.videoHeight = 240;

            mediaRecorder.ondataavailable = function(blob) {
                var outVideo = document.createElement('video');
                outVideo.src = window.URL.createObjectURL(blob);
                videosContainer.appendChild(outVideo);
            };

            mediaRecorder.start(3000);
        };

        var errorCallback = function(e) {
          console.log("Failed to create video stream!", e);
        };

        if (navigator.getUserMedia) {
            navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);
        }
    }
    </script>
-->

        <script src="//www.webrtc-experiment.com/RecordRTC.js"> </script>

  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="{{servlet-context}}/">gifer</a>
        </div>
        {% block menu %}
          {% include "gifer/views/templates/menu.html" %}
        {% endblock %}
      </div>
    </div>
   <div class="container">
      {% if not user-id %}
      <div class="alert alert-warning alert-dismissable">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
          Your grandkids are gonna wanna see this! Log in to save your GIFs for posterity, or dodge the NSA by continuing to GIF anonymously.
      </div>
      {% endif %}
      {% block content %}
      {% endblock %}
    </div>
    <!-- scripts and styles -->
      <script>
          var inVideo = document.getElementById('inVideo');
          var outVideo = document.getElementById('outVideo');

          var videosContainer = document.getElementById('videos-container');
          var mediaConstraints = { video: true };
          navigator.getUserMedia(mediaConstraints, onMediaSuccess, onMediaError);
          function onMediaSuccess(stream) {
              window.stream = stream;
              inVideo.src = URL.createObjectURL(stream);
              videosContainer.appendChild(document.createElement('hr'));
          }

          function onMediaError(e) {
              console.error('media error', e);
          }
          function record() {
              var options = { type: 'video' };
              var recordRTC = RecordRTC(window.stream, options);
              recordRTC.startRecording();
              function stop() {
                  recordRTC.stopRecording(function(videoURL) {
                      outVideo.src = videoURL;
                  });
              }
              setTimeout(stop, 5000);
          }

          var filters = ['grayscale', 'sepia', 'blur', 'brightness',
                         'contrast', 'hue-rotate', 'hue-rotate2',
                         'hue-rotate3', 'saturate', 'invert', ''];

          function changeFilter(index) {
              var el = outVideo;
              el.className = '';
              var effect = filters[index]; // loop through filters.
              if (effect) {
                  el.classList.add(effect);
              }
          }
      </script>
    {% style "/css/bootstrap-theme.min.css" %}
    {% style "/css/bootstrap.min.css" %}
    {% style "/css/screen.css" %}
    <script src="//code.jquery.com/jquery-2.0.3.min.js" type="text/javascript"></script>
    {% script "/js/bootstrap.min.js" %}
    <script type="text/javascript">
      var context = "{{servlet-context}}";
      $(function() {
        $("#{{selected-page}}").addClass("active");
      });
    </script>
  </body>
</html>
